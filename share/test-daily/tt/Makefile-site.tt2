all: index.html

# index file
index.html: [% ttdir %]/site.tt2 [% FOREACH project IN folders; "$project/index.html "; END; %]
	test-daily site-summary

[% FOREACH project IN folders; -%]
# project Makefile
[% project %]/Makefile: [% ttdir %]/Makefile-project.tt2
	test-daily project-makefile [% project %]

# project index page
[% project %]/index.html: [% project %]/Makefile
	cd [% project %] && make

[%- END; -%]

# clean up the mess
clean:
	rm -f index.html
[% FOREACH project IN folders; -%]
	cd [% project %] && make clean
[% END; -%]
